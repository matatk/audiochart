{"version":3,"sources":["../src/audiochart.js","../src/export.js"],"names":["isProbablySafari","GoogleDataWrapper","data","this","prototype","numSeries","getNumberOfColumns","seriesNames","results","i","push","getColumnLabel","seriesMin","series","getColumnRange","min","seriesMax","max","seriesValue","index","getValue","seriesLength","getNumberOfRows","JSONDataWrapper","json","object","JSON","parse","Error","length","Math","apply","values","HTMLTableDataWrapper","table","getElementsByTagName","children","headerCells","textContent","_seriesFloats","dataCells","parseFloat","PitchMapper","minimumDatum","maximumDatum","map","datum","FrequencyPitchMapper","minimumFrequency","maximumFrequency","call","dataRange","Object","create","constructor","ratio","WebAudioSounder","context","start","oscillator","createOscillator","connect","destination","frequency","value","stop","Player","duration","pitchMapper","sounder","visualCallback","arguments","interval","ceil","seriesMaxIndex","_state","playPause","_play","_pause","_playLoop","String","playIndex","skippedCalls","_playOne","that","intervalID","setInterval","_playOneWrapper","clearInterval","setTimeout","stepBackward","skip","delta","stepForward","AudioContextGetter","audioContext","_getAudioContext","undefined","window","AudioContext","webkitAudioContext","get","googleVisualCallbackMaker","chart","row","setSelection","column","htmlTableVisualCallbackMaker","className","tds","classList","remove","add","KeyboardHandler","container","player","setAttribute","addEventListener","keypressHandler","bind","keyName","keyboardEvent","key","keyIdentifier","evt","preventDefault","handleRight","handleLeft","handleSpace","_AudioChart","options","result","_assignWrapperCallback","dataWrapper","Wrapper","parameter","callback","frequencyPitchMapper","frequencyLow","frequencyHigh","chartContainer","type","hasOwnProperty","highlightClass","AudioChart","exports"],"mappings":"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","file":"audiochart.min.js","sourcesContent":["'use strict'\n/** @module */\n\nvar isProbablySafari = false  // try to detect Safari\n\n/**\n * Array index number (starts at zero).\n * Used to specify series and row in visual callbacks.\n * @typedef {integer} index\n */\n\n\n/**\n * A function that highlights the current datum visually.\n * Different callbacks must be created for different types of chart.\n * @callback VisualCallback\n * @param {index} series - The column of the cell to highlight\n * @param {index} row - The row of the cell to highlight\n */\n\n\n/**\n * The common interface that the other DataWrappers use.\n *\n * The common DataWrapper 'interface' is validated via the tests.\n *\n * Note: it is not done as a superclass (as {@link PitchMapper} is) because\n *       there's really nothing in common implementation-wise; only the\n *       interface is shared.\n *\n * @interface DataWrapper\n * @private\n * @todo fix the link in this comment\n */\n/**\n * Returns the number of series in the underlying data\n * @function DataWrapper#numSeries\n * @returns {integer} The number of series\n */\n/**\n * Get a list of the underlying data series names\n * @function DataWrapper#seriesNames\n * @returns {string[]} An array of the series names\n */\n/**\n * What is the minimum value in a given series?\n * @function DataWrapper#seriesMin\n * @param {index} series - The series number\n * @returns {Number} The minimum value in the series\n */\n/**\n * What is the maximum value in a given series?\n * @function DataWrapper#seriesMax\n * @param {index} series - The series number\n * @returns {Number} The maximum value in the series\n */\n/**\n * Get value of specific datum\n * @function DataWrapper#seriesValue\n * @param {index} series - The series number\n * @param {index} index - The row number\n * @todo rename `index` to `row`?\n * @returns {Number} the datum\n */\n/**\n * What is the length of a series?\n * @function DataWrapper#seriesLength\n * @param {index} series - The series\n * @returns {integer} The number of data in the series\n */\n\n\nvar GoogleDataWrapper = (function() {\n\t/**\n\t * @constructor GoogleDataWrapper\n\t * @private\n\t * @implements {DataWrapper}\n\t * @param {GoogleDataTable} data - The in-memory GoogleDataTable\n\t */\n\tfunction GoogleDataWrapper(data) {\n\t\tthis.data = data\n\t}\n\n\tGoogleDataWrapper.prototype.numSeries = function() {\n\t\treturn this.data.getNumberOfColumns() - 1\n\t}\n\n\tGoogleDataWrapper.prototype.seriesNames = function() {\n\t\tvar results = []\n\t\tfor (var i = 0; i < this.data.getNumberOfColumns() - 1; i++) {\n\t\t\tresults.push(this.data.getColumnLabel(i))\n\t\t}\n\t\treturn results\n\t}\n\n\tGoogleDataWrapper.prototype.seriesMin = function(series) {\n\t\treturn this.data.getColumnRange(series + 1).min\n\t}\n\n\tGoogleDataWrapper.prototype.seriesMax = function(series) {\n\t\treturn this.data.getColumnRange(series + 1).max\n\t}\n\n\tGoogleDataWrapper.prototype.seriesValue = function(series, index) {\n\t\treturn this.data.getValue(index, series + 1)\n\t}\n\n\tGoogleDataWrapper.prototype.seriesLength = function(series) {\n\t\treturn this.data.getNumberOfRows()\n\t}\n\n\treturn GoogleDataWrapper\n})()\n\n\nvar JSONDataWrapper = (function() {\n\t/**\n\t * @constructor JSONDataWrapper\n\t * @private\n\t * @implements {DataWrapper}\n\t * @param {JSON} json - The JSON data, as a string or object\n\t */\n\tfunction JSONDataWrapper(json) {\n\t\tif (typeof json === 'string') {\n\t\t\tthis.object = JSON.parse(json)\n\t\t} else if (typeof json === 'object') {\n\t\t\tthis.object = json\n\t\t} else {\n\t\t\tthrow Error('Please provide a JSON string or derived object.')\n\t\t}\n\t}\n\n\tJSONDataWrapper.prototype.numSeries = function() {\n\t\treturn this.object.data.length\n\t}\n\n\tJSONDataWrapper.prototype.seriesNames = function() {\n\t\tvar results = []\n\t\tfor (var i = 0; i < this.object.data.length; i++) {\n\t\t\tresults.push(this.object.data[i].series)\n\t\t}\n\t\treturn results\n\t}\n\n\tJSONDataWrapper.prototype.seriesMin = function(series) {\n\t\treturn Math.min.apply(this, this.object.data[series].values)\n\t}\n\n\tJSONDataWrapper.prototype.seriesMax = function(series) {\n\t\treturn Math.max.apply(this, this.object.data[series].values)\n\t}\n\n\tJSONDataWrapper.prototype.seriesValue = function(series, index) {\n\t\treturn this.object.data[series].values[index]\n\t}\n\n\tJSONDataWrapper.prototype.seriesLength = function(series) {\n\t\treturn this.object.data[series].values.length\n\t}\n\n\treturn JSONDataWrapper\n})()\n\n\nvar HTMLTableDataWrapper = (function() {\n\t/**\n\t * @constructor HTMLTableDataWrapper\n\t * @private\n\t * @implements {DataWrapper}\n\t * @param {HTMLTableElement} table - The in-DOM table element\n\t * @todo check it's a table\n\t */\n\tfunction HTMLTableDataWrapper(table) {\n\t\tthis.table = table\n\t\tif (!this.table) {\n\t\t\tthrow Error('No table given.')\n\t\t}\n\t}\n\n\tHTMLTableDataWrapper.prototype.numSeries = function() {\n\t\treturn this.table.getElementsByTagName('tr')[0].children.length\n\t}\n\n\tHTMLTableDataWrapper.prototype.seriesNames = function() {\n\t\tvar headerCells = this.table.getElementsByTagName('th')\n\t\tvar results = []\n\t\tfor (var i = 0; i < headerCells.length; i++) {\n\t\t\tresults.push(headerCells[i].textContent)\n\t\t}\n\t\treturn results\n\t}\n\n\tHTMLTableDataWrapper.prototype._seriesFloats = function(series) {\n\t\tvar dataCells = this.table.getElementsByTagName('td')\n\t\tvar results = []\n\t\tfor (var i = 0; i < dataCells.length; i++) {\n\t\t\tresults.push(parseFloat(dataCells[i].textContent))\n\t\t}\n\t\treturn results\n\t}\n\n\tHTMLTableDataWrapper.prototype.seriesMin = function(series) {\n\t\treturn Math.min.apply(this, this._seriesFloats(series))\n\t}\n\n\tHTMLTableDataWrapper.prototype.seriesMax = function(series) {\n\t\treturn Math.max.apply(this, this._seriesFloats(series))\n\t}\n\n\tHTMLTableDataWrapper.prototype.seriesValue = function(series, index) {\n\t\treturn parseFloat(this.table.getElementsByTagName('tr')[index + 1].children[series].textContent)\n\t}\n\n\tHTMLTableDataWrapper.prototype.seriesLength = function(series) {\n\t\treturn this.table.getElementsByTagName('tr').length - 1\n\t}\n\n\treturn HTMLTableDataWrapper\n})()\n\n\nvar PitchMapper = (function() {\n\t/**\n\t * @constructor PitchMapper\n\t * @private\n\t * @param {number} minimumDatum - the minimum value in this data series\n\t * @param {number} maximumDatum - the maximum value in this data series\n\t */\n\tfunction PitchMapper(minimumDatum, maximumDatum) {\n\t\tthis.minimumDatum = minimumDatum\n\t\tthis.maximumDatum = maximumDatum\n\t\tif (this.minimumDatum > this.maximumDatum) {\n\t\t\tthrow Error('minimum datum should be <= maximum datum')\n\t\t}\n\t}\n\n\t/**\n\t * Map a datum to an output value\n\t * @abstract\n\t * @param {number} datum - the datum to be mapped\n\t */\n\tPitchMapper.prototype.map = function(datum) {}  // FIXME naming conflict?\n\n\treturn PitchMapper\n})()\n\n\nvar FrequencyPitchMapper = (function() {\n\t/**\n\t * @constructor FrequencyPitchMapper\n\t * @private\n\t * @extends {PitchMapper}\n\t * @param {number} minimumDatum - the minimum value in this data series\n\t * @param {number} maximumDatum - the maximum value in this data series\n\t * @param {number} minimumFrequency - the minimum output frequency\n\t * @param {number} maximumFrequency - the maximum output frequency\n\t */\n\tfunction FrequencyPitchMapper(minimumDatum, maximumDatum, minimumFrequency, maximumFrequency) {\n\t\tthis.minimumFrequency = minimumFrequency\n\t\tthis.maximumFrequency = maximumFrequency\n\t\tPitchMapper.call(this, minimumDatum, maximumDatum)\n\t\tif (this.minimumFrequency > this.maximumFrequency) {\n\t\t\tthrow Error('minimum frequency should be <= maximum frequency')\n\t\t}\n\t\tthis.dataRange = this.maximumDatum - this.minimumDatum\n\t}\n\n\tFrequencyPitchMapper.prototype = Object.create(PitchMapper.prototype)\n\tFrequencyPitchMapper.prototype.constructor = FrequencyPitchMapper\n\n\t/**\n\t * @param {number} datum - the datum to be mapped\n\t * @returns {number} frequency for this datum\n\t */\n\tFrequencyPitchMapper.prototype.map = function(datum) {\n\t\tvar ratio\n\t\tif (this.dataRange) {\n\t\t\tratio = (datum - this.minimumDatum) / this.dataRange\n\t\t} else {\n\t\t\tratio = 0.5\n\t\t}\n\t\treturn this.minimumFrequency + ratio * (this.maximumFrequency - this.minimumFrequency)\n\t}\n\n\treturn FrequencyPitchMapper\n})()\n\n\nvar WebAudioSounder = (function() {\n\t/**\n\t * @constructor WebAudioSounder\n\t * @private\n\t * @param {AudioContext} context - the Web Audio API context\n\t */\n\tfunction WebAudioSounder(context) {\n\t\tthis.context = context\n\t}\n\n\t/**\n\t * Start the oscillator\n\t */\n\tWebAudioSounder.prototype.start = function() {\n\t\t// Oscillators cannot be re-used\n\t\tthis.oscillator = this.context.createOscillator()\n\t\tthis.oscillator.connect(this.context.destination)\n\t\tthis.oscillator.start(0)\n\t}\n\n\t/**\n\t * Set the frequency of the oscillator at a given point in time\n\t * @param {number} frequency - the frequency to change to\n\t */\n\tWebAudioSounder.prototype.frequency = function(frequency) {\n\t\tthis.oscillator.frequency.value = frequency\n\t}\n\n\t/**\n\t * Stop the oscillator at a given time\n\t */\n\tWebAudioSounder.prototype.stop = function() {\n\t\tthis.oscillator.stop()\n\t}\n\n\treturn WebAudioSounder\n})()\n\n\nvar Player = (function() {\n\t/**\n\t * Orchestrates the audible (and visual cursor) rendering of the chart\n\t * @constructor Player\n\t * @private\n\t * @param {integer} duration - the length of the rendering in milliseconds\n\t * @param {DataWrapper} data - the underlying data (wrapped in interface)\n\t * @param {PitchMapper} pitchMapper - maps data to pitches\n\t * @param {WebAudioSounder} sounder - the sounder object\n\t * @param {VisualCallback} visualCallback - the callback function that highlights the current datum\n\t */\n\tfunction Player(duration, data, pitchMapper, sounder, visualCallback) {\n\t\tthis.data = data\n\t\tthis.pitchMapper = pitchMapper\n\t\tthis.sounder = sounder\n\t\tif (arguments.length < 5) {\n\t\t\tthis.visualCallback = null\n\t\t} else {\n\t\t\tthis.visualCallback = visualCallback\n\t\t}\n\n\t\tthis.interval = Math.ceil(duration / this.data.seriesLength(0))\n\t\t// console.log('Player: duration', duration, 'interval', this.interval)\n\t\tthis.seriesMaxIndex = this.data.seriesLength(0) - 1\n\n\t\tthis._state = 'ready'\n\t}\n\n\t/**\n\t * Main entry point; manages state.\n\t */\n\tPlayer.prototype.playPause = function() {\n\t\tswitch (this._state) {\n\t\t\tcase 'ready':\n\t\t\t\tthis._play()\n\t\t\t\tbreak\n\t\t\tcase 'playing':\n\t\t\t\tthis._pause()\n\t\t\t\tbreak\n\t\t\tcase 'paused':\n\t\t\t\tthis._playLoop()\n\t\t\t\tbreak\n\t\t\tcase 'finished':\n\t\t\t\tthis._play()\n\t\t\t\tbreak\n\t\t\tdefault:\n\t\t\t\tthrow Error('Player error: invalid state: ' + String(this._state))\n\t\t}\n\t}\n\n\t/**\n\t * Resets play state and sets up a recurring function to update the sound\n\t * (and, optionally, visual callback) at an interval dependant on the\n\t * number of data.\n\t */\n\tPlayer.prototype._play = function() {\n\t\t// this.startTime = new Date()\n\t\tthis.sounder.start(0)\n\n\t\tthis.playIndex = 0\n\t\tthis.skippedCalls = 0\n\n\t\tthis._playLoop()\n\t}\n\n\t/**\n\t * Update state and set _playOne() to run regularly, to render the sound\n\t * (and optional visual cursor movement).\n\t */\n\tPlayer.prototype._playLoop = function() {\n\t\tthis._state = 'playing'\n\t\tthis._playOne()  // so that it starts immediately\n\t\tvar that = this\n\t\tthis.intervalID = setInterval(function() {\n\t\t\tthat._playOneWrapper()\n\t\t}, this.interval)\n\t}\n\n\t/**\n\t * Firefox and Chrome both seem to handle running `_playOne()` with an\n\t * interval of ~5ms fine, but Safari really lags when doing so, so here is\n\t * an unfortunately hacky workaround untill I'm better able to understand\n\t * what's going on.\n\t *\n\t * @todo: this may only apply to Google charts visual callbacks.\n\t *\n\t * @todo: ascertain if it's worth changing frequency at <10ms intervals;\n\t * if not then the incoming data should be filtered in some way,\n\t * thus negating this issue.\n\t */\n\tPlayer.prototype._playOneWrapper = function() {\n\t\tif (isProbablySafari\n\t\t\t&& this.interval < 10\n\t\t\t&& this.playIndex !== this.seriesMaxIndex\n\t\t\t&& this.playIndex % 2 === 0) {\n\t\t\tthis.playIndex++\n\t\t\tthis.skippedCalls++\n\t\t\treturn\n\t\t}\n\n\t\tthis._playOne()\n\t}\n\n\t/**\n\t * This is where the sound is actually played.  If a visual callback was\n\t * specified, this also coordinates the visual highlighting of the current\n\t * datum as the playback occurs.\n\t */\n\tPlayer.prototype._playOne = function() {\n\t\tif (this.visualCallback !== null) {\n\t\t\tthis.visualCallback(0, this.playIndex)\n\t\t}\n\n\t\tthis.sounder.frequency(\n\t\t\tthis.pitchMapper.map(\n\t\t\t\tthis.data.seriesValue(0, this.playIndex)))\n\n\t\tif (this.playIndex === this.seriesMaxIndex) {\n\t\t\tclearInterval(this.intervalID)\n\t\t\tvar that = this\n\t\t\tsetTimeout(function() {\n\t\t\t\tthat.sounder.stop()\n\t\t\t}, this.interval)  // TODO test\n\t\t\tthis._state = 'finished'\n\t\t\t// console.log('playback took:', new Date() - this.startTime)\n\t\t\t// console.log('skipped calls:', this.skippedCalls)\n\t\t}\n\n\t\tthis.playIndex += 1\n\t}\n\n\t/**\n\t * Temporarily pause the rendering of the chart.\n\t * This inherently keeps the sound going at the frequency it was at when\n\t * the pause was triggered.\n\t * @todo feature/object to stop/fade the sound after n seconds?\n\t */\n\tPlayer.prototype._pause = function() {\n\t\tclearInterval(this.intervalID)\n\t\tthis._state = 'paused'\n\t}\n\n\tPlayer.prototype.stepBackward = function(skip) {\n\t\tvar delta = skip || 50\n\t\tthis.playIndex -= delta\n\t\tif (this.playIndex < 0) {\n\t\t\tthis.playIndex = 0  // TODO test limiting\n\t\t}\n\t\tif (this._state === 'paused') {\n\t\t\tthis._playOne()\n\t\t}\n\t}\n\n\tPlayer.prototype.stepForward = function(skip) {\n\t\tvar delta = skip || 50\n\t\tthis.playIndex += delta\n\t\tif (this.playIndex > this.seriesMaxIndex) {\n\t\t\tthis.playIndex = this.seriesMaxIndex  // TODO test limiting\n\t\t}\n\t\tif (this._state === 'paused') {\n\t\t\tthis._playOne()\n\t\t}\n\t}\n\n\treturn Player\n})()\n\n\nvar AudioContextGetter = (function() {\n\t/**\n\t * @constructor AudioContextGetter\n\t * @private\n\t */\n\tfunction AudioContextGetter() {}\n\n\tvar audioContext = null\n\n\tvar _getAudioContext = function() {\n\t\tif (window.AudioContext !== undefined) {\n\t\t\treturn new window.AudioContext()\n\t\t} else if (window.webkitAudioContext !== undefined) {\n\t\t\t/* eslint-disable new-cap */\n\t\t\tisProbablySafari = true\n\t\t\treturn new window.webkitAudioContext()\n\t\t\t/* eslint-enable new-cap */\n\t\t}\n\t\treturn null\n\t}\n\n\t/**\n\t * @returns {AudioContext} the page-global Web Audio context\n\t */\n\tAudioContextGetter.get = function() {\n\t\treturn audioContext !== null ? audioContext : audioContext = _getAudioContext()\n\t}\n\n\treturn AudioContextGetter\n})()\n\n\n/**\n * Generates a function that moves the cursor on a Google Chart\n * @private\n * @param {GoogleChart} chart - the in-memory GoogleChart object\n * @returns {VisualCallback} the callback\n */\nvar googleVisualCallbackMaker = function(chart) {\n\treturn function(series, row) {\n\t\tchart.setSelection([\n\t\t\t{\n\t\t\t\t'row': row,\n\t\t\t\t'column': series + 1\n\t\t\t}\n\t\t])\n\t}\n}\n\n\n/**\n * Generate a callback that can be used to highlight table cells\n * @private\n * @param {HTMLTableElement} table - The in-DOM table element\n * @param {string} className - Name of the CSS highlight class\n * @returns {VisualCallback} The highlighting function\n */\nvar htmlTableVisualCallbackMaker = function(table, className) {\n\treturn function(series, row) {\n\t\tvar tds = table.getElementsByTagName('td')\n\t\tvar cell  // TODO remove\n\t\tfor (var i = 0; i < tds.length; i++) {\n\t\t\tcell = tds[i]\n\t\t\tcell.classList.remove(className)\n\t\t}\n\t\tcell = table.getElementsByTagName('td')[row]\n\t\tcell.classList.add(className)\n\t}\n}\n\n\nvar KeyboardHandler = (function() {\n\t/**\n\t * @constructor KeyboardHandler\n\t * @private\n\t * @param {HTMLDivElement} container - The DIV containing the chart\n\t * @param {Player} player - AudioChart Player object\n\t * @todo mark up the DIV properly\n\t * @todo check what sort of element we get given? no; could be button?\n\t */\n\tfunction KeyboardHandler(container, player) {\n\t\tif (!container) {\n\t\t\tthrow Error('No container given')\n\t\t}\n\t\tcontainer.setAttribute('tabindex', '0')\n\t\tcontainer.addEventListener('keydown', this.keypressHandler.bind(this))\n\n\t\tif (!player) {\n\t\t\tthrow Error('No Player given')\n\t\t}\n\t\tthis.player = player\n\t}\n\n\t/**\n\t * Support both standard and Safari methods of checking the key\n\t * @param {KeyboardEvent} keyboardEvent - the event\n\t * @returns {string} the name of the pressed key\n\t */\n\tfunction keyName(keyboardEvent) {\n\t\tif (keyboardEvent.key) {\n\t\t\treturn keyboardEvent.key\n\t\t} else if (keyboardEvent.keyIdentifier) {\n\t\t\treturn keyboardEvent.keyIdentifier\n\t\t}\n\t\tthrow new Error('Keyboard Events API unsupported')\n\t}\n\n\t/**\n\t * Handle keypresses\n\t *\n\t * Note: This is bound to the {@link KeyboardHandler} so that it can call\n\t *       the right handler methods.\n\t *\n\t * @param {KeyboardEvent} evt - the KeyboardEvent that occured\n\t * @todo make link work\n\t */\n\tKeyboardHandler.prototype.keypressHandler = function(evt) {\n\t\tevt.preventDefault()\n\n\t\tif (keyName(evt) === 'Right') {\n\t\t\tthis.handleRight()\n\t\t} else if (keyName(evt) === 'Left' ) {\n\t\t\tthis.handleLeft()\n\t\t} else if (keyName(evt) === 'U+0020') {\n\t\t\tthis.handleSpace()\n\t\t}\n\t}\n\n\t/** Handle a left arrow being pressed */\n\tKeyboardHandler.prototype.handleLeft = function() {\n\t\tthis.player.stepBackward()\n\t}\n\n\t/** Handle a right arrow being pressed */\n\tKeyboardHandler.prototype.handleRight = function() {\n\t\tthis.player.stepForward()\n\t}\n\n\t/** Handle the space key being pressed */\n\tKeyboardHandler.prototype.handleSpace = function() {\n\t\tthis.player.playPause()\n\t}\n\n\treturn KeyboardHandler\n})()\n\n\nvar _AudioChart = (function() {\n\t/**\n\t * @constructor _AudioChart\n\t * @private\n\t * @param {options} options - AudioChart options\n\t * @param {AudioContext} context - the window's AudioContext\n\t */\n\tfunction _AudioChart(options, context) {\n\t\tvar result = _AudioChart._assignWrapperCallback(options)\n\t\tvar dataWrapper = new result.Wrapper(result.parameter)\n\t\tvar callback = result.callback\n\n\t\tvar frequencyPitchMapper = new FrequencyPitchMapper(\n\t\t\tdataWrapper.seriesMin(0),\n\t\t\tdataWrapper.seriesMax(0),\n\t\t\toptions.frequencyLow,\n\t\t\toptions.frequencyHigh)\n\n\t\tvar sounder = new WebAudioSounder(context)\n\n\t\tthis.player = new Player(\n\t\t\toptions.duration,\n\t\t\tdataWrapper,\n\t\t\tfrequencyPitchMapper,\n\t\t\tsounder,\n\t\t\tcallback)\n\n\t\tif (options.chartContainer) {\n\t\t\tnew KeyboardHandler(\n\t\t\t\toptions.chartContainer,\n\t\t\t\tthis.player)\n\t\t}\n\t}\n\n\t/**\n\t * Passes through play/pause commands to the Player\n\t */\n\t_AudioChart.prototype.playPause = function() {\n\t\tthis.player.playPause()\n\t}\n\n\t// This is being done as a sort of 'class/static method' because\n\t// it doesn't need 'this'.\n\t// http://stackoverflow.com/a/1635143\n\t_AudioChart._assignWrapperCallback = function(options) {\n\t\tvar result = {\n\t\t\t'Wrapper': null,\n\t\t\t'parameter': null,\n\t\t\t'callback': null\n\t\t}\n\n\t\tswitch (options.type) {\n\t\t\tcase 'google':\n\t\t\t\tresult.Wrapper = GoogleDataWrapper\n\t\t\t\tresult.parameter = options.data\n\t\t\t\tif (options.hasOwnProperty('chart')) {\n\t\t\t\t\tresult.callback =\n\t\t\t\t\t\tgoogleVisualCallbackMaker(options.chart)\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\tcase 'json':\n\t\t\t\tresult.Wrapper = JSONDataWrapper\n\t\t\t\tresult.parameter = options.data\n\t\t\t\tbreak\n\t\t\tcase 'htmlTable':\n\t\t\t\tresult.Wrapper = HTMLTableDataWrapper\n\t\t\t\tresult.parameter = options.table\n\t\t\t\tif (options.hasOwnProperty('highlightClass')) {\n\t\t\t\t\tresult.callback = htmlTableVisualCallbackMaker(\n\t\t\t\t\t\toptions.table,\n\t\t\t\t\t\toptions.highlightClass)\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\tdefault:\n\t\t\t\tthrow Error(\"Invalid data type '\" + options.type + \"' given.\")\n\t\t}\n\n\t\treturn result\n\t}\n\n\treturn _AudioChart\n})()\n\n\nvar AudioChart = (function() {\n\t/**\n\t * Main entry point for API consumers.\n\t * This first checks to see if the Web Audio API is available, and\n\t * throws an {Error} if not.\n\t * @constructor AudioChart\n\t * @param {options} options - AudioChart options\n\t * @param {AudioContext} context - the window's AudioContext\n\t * @returns {_AudioChart} the real AudioChart object\n\t */\n\tfunction AudioChart(options, context) {\n\t\tvar fail = \"Sorry, your browser doesn't support the Web Audio API.\"\n\t\tif (arguments.length < 2) {\n\t\t\tcontext = AudioContextGetter.get()\n\t\t\tif (context === null) {\n\t\t\t\tthrow Error(fail)\n\t\t\t}\n\t\t}\n\n\t\treturn new _AudioChart(options, context)\n\t}\n\n\treturn AudioChart\n})()\n","exports.AudioChart = AudioChart;\n"]}
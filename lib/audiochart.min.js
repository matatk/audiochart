"use strict";!function(t){class e{constructor(t){this.data=t}numSeries(){return this.data.getNumberOfColumns()-1}seriesNames(){const t=[];for(let e=0;e<this.data.getNumberOfColumns()-1;e++)t.push(this.data.getColumnLabel(e));return t}seriesMin(t){return this.data.getColumnRange(t+1).min}seriesMax(t){return this.data.getColumnRange(t+1).max}seriesValue(t,e){return this.data.getValue(e,t+1)}seriesLength(t){return this.data.getNumberOfRows()}}class s{constructor(t){if("string"==typeof t)this.object=JSON.parse(t);else{if("object"!=typeof t)throw Error("Please provide a JSON string or derived object.");this.object=t}}numSeries(){return this.object.data.length}seriesNames(){const t=[];for(let e=0;e<this.object.data.length;e++)t.push(this.object.data[e].series);return t}seriesMin(t){return Math.min.apply(this,this.object.data[t].values)}seriesMax(t){return Math.max.apply(this,this.object.data[t].values)}seriesValue(t,e){return this.object.data[t].values[e]}seriesLength(t){return this.object.data[t].values.length}}class a{constructor(t){if("object"!=typeof t)throw Error("Please provide a C3-format data object.");this.object=t}numSeries(){return this.object.columns.length}seriesNames(){const t=[];for(let e=0;e<this.object.columns.length;e++)t.push(this.object.columns[e][0]);return t}seriesMin(t){return Math.min.apply(this,this.object.columns[t].slice(1))}seriesMax(t){return Math.max.apply(this,this.object.columns[t].slice(1))}seriesValue(t,e){return this.object.columns[t][e+1]}seriesLength(t){return this.object.columns[t].length-1}}class r{constructor(t){if(this.table=t,!this.table)throw Error("No table given.")}numSeries(){return this.table.getElementsByTagName("tr")[0].children.length}seriesNames(){const t=this.table.getElementsByTagName("th"),e=[];for(let s=0;s<t.length;s++)e.push(t[s].textContent);return e}_seriesFloats(t){const e=this.table.getElementsByTagName("td"),s=[];for(let t=0;t<e.length;t++)s.push(parseFloat(e[t].textContent));return s}seriesMin(t){return Math.min.apply(this,this._seriesFloats(t))}seriesMax(t){return Math.max.apply(this,this._seriesFloats(t))}seriesValue(t,e){return parseFloat(this.table.getElementsByTagName("tr")[e+1].children[t].textContent)}seriesLength(t){return this.table.getElementsByTagName("tr").length-1}}class i{constructor(t,e){if(this.minimumDatum=t,this.maximumDatum=e,this.minimumDatum>this.maximumDatum)throw Error("minimum datum should be <= maximum datum")}map(t){throw new Error("Base map() must be overriden.")}}class n extends i{constructor(t,e,s,a){if(super(t,e),this.minimumFrequency=s,this.maximumFrequency=a,this.minimumFrequency>this.maximumFrequency)throw Error("minimum frequency must be <= maximum frequency");this.dataRange=this.maximumDatum-this.minimumDatum}map(t){let e;return e=this.dataRange?(t-this.minimumDatum)/this.dataRange:.5,this.minimumFrequency+e*(this.maximumFrequency-this.minimumFrequency)}}class l{constructor(t){this.context=t}start(){this.oscillator=this.context.createOscillator(),this.oscillator.connect(this.context.destination),this.oscillator.start(0)}frequency(t){this.oscillator.frequency.value=t}stop(){this.oscillator.stop()}}class o{constructor(t,e,s,a,r){this.data=e,this.pitchMapper=s,this.sounder=a,arguments.length<5?this.visualCallback=null:this.visualCallback=r;const i=this.data.seriesLength(0),n=o.samplingInfo(t,i);this.interval=n.interval,this.sampleOneIn=n.in,this.seriesMaxIndex=i-1,this._state="ready"}static samplingInfo(t,e){let s,a,r;const i=Math.ceil(t/e);if(console.log(`sampleInfo: duration: ${t}; series length: ${e}; ideal interval: ${i}`),i<10){s=10;const i=e/(r=Math.floor(t/10));a=Math.round(e/r),console.log(`sampleInfo: Need to sample 1 in ${a} (${i})`)}else r=Math.floor(t/10),s=i,a=1;return console.log(`sampleInfo: it will take ${e/a*s}`),{sample:1,in:a,interval:s}}playPause(){switch(this._state){case"ready":this._play();break;case"playing":this._pause();break;case"paused":this._playLoop();break;case"finished":this._play();break;default:throw Error("Player error: invalid state: "+String(this._state))}}_play(){this.playTimes=[],this.playCount=0,this.startTime=performance.now(),this.sounder.start(0),this.playIndex=0,this._playLoop()}_playLoop(){this._state="playing",this._playOne(),this.intervalID=setInterval(()=>this._playOne(),this.interval)}_playOne(){const t=performance.now();if(this.playIndex<=this.seriesMaxIndex)null!==this.visualCallback&&this.visualCallback(0,this.playIndex),this.sounder.frequency(this.pitchMapper.map(this.data.seriesValue(0,this.playIndex)));else{clearInterval(this.intervalID),this.sounder.stop(),this._state="finished",console.log(`Player: Playing ${this.playCount} of ${this.playIndex} took ${Math.round(performance.now()-this.startTime)} ms`);const t=this.playTimes.reduce((t,e)=>t+e)/this.playTimes.length;console.log(`Player: Average play func time: ${t.toFixed(2)} ms`)}this.playIndex+=this.sampleOneIn>0?this.sampleOneIn:1,this.playCount+=1,this.playTimes.push(performance.now()-t)}_pause(){clearInterval(this.intervalID),this._state="paused"}stepBackward(t){const e=t||50;this.playIndex-=e,this.playIndex<0&&(this.playIndex=0),"paused"===this._state&&this._playOne()}stepForward(t){const e=t||50;this.playIndex+=e,this.playIndex>this.seriesMaxIndex&&(this.playIndex=this.seriesMaxIndex),"paused"===this._state&&this._playOne()}}var h=function(){let t=null;return void 0!==window.AudioContext?t=new window.AudioContext:void 0!==window.webkitAudioContext&&(t=new window.webkitAudioContext),function(){return t}}(),u=function(t){return function(e,s){t.setSelection([{row:s,column:e+1}])}},c=function(t,e){return function(s,a){const r=t.getElementsByTagName("td");let i;for(let t=0;t<r.length;t++)(i=r[t]).classList.remove(e);(i=t.getElementsByTagName("td")[a]).classList.add(e)}},m=function(t){return function(e,s){t.select(null,[s],!0)}};class p{constructor(t,e){if(!t)throw Error("No container given");if(!e)throw Error("No Player given");t.setAttribute("tabindex","0"),t.addEventListener("keydown",this.keypressHandler.bind(this)),this.player=e}keypressHandler(t){t.preventDefault(),"ArrowRight"===t.key?this.handleRight():"ArrowLeft"===t.key?this.handleLeft():" "===t.key&&this.handleSpace()}handleLeft(){this.player.stepBackward()}handleRight(){this.player.stepForward()}handleSpace(){this.player.playPause()}}class d{constructor(t,e){if(arguments.length<2&&null===(e=h()))throw Error("Sorry, your browser doesn't support the Web Audio API.");const s=d._assignWrapperCallback(t),a=new s.Wrapper(s.parameter),r=s.callback,i=new n(a.seriesMin(0),a.seriesMax(0),t.frequencyLow,t.frequencyHigh),u=new l(e);this.player=new o(t.duration,a,i,u,r),t.chartContainer&&new p(t.chartContainer,this.player)}playPause(){this.player.playPause()}static _assignWrapperCallback(t){const i={Wrapper:null,parameter:null,callback:null};switch(t.type){case"google":i.Wrapper=e,i.parameter=t.data,t.hasOwnProperty("chart")&&(i.callback=u(t.chart));break;case"json":i.Wrapper=s,i.parameter=t.data;break;case"htmlTable":i.Wrapper=r,i.parameter=t.table,t.hasOwnProperty("highlightClass")&&(i.callback=c(t.table,t.highlightClass));break;case"c3":i.Wrapper=a,i.parameter=t.data,t.hasOwnProperty("chart")&&(i.callback=m(t.chart));break;default:throw Error("Invalid data type '"+t.type+"' given.")}return i}}t.AudioChart=d}(this);
//# sourceMappingURL=audiochart.min.js.map
/* audiochart 0.2.1 - 2017-09-19 - MIT licence */

"use strict";var isProbablySafari=!1,GoogleDataWrapper=function(){function t(t){this.data=t}return t.prototype.numSeries=function(){return this.data.getNumberOfColumns()-1},t.prototype.seriesNames=function(){for(var t=[],e=0;e<this.data.getNumberOfColumns()-1;e++)t.push(this.data.getColumnLabel(e));return t},t.prototype.seriesMin=function(t){return this.data.getColumnRange(t+1).min},t.prototype.seriesMax=function(t){return this.data.getColumnRange(t+1).max},t.prototype.seriesValue=function(t,e){return this.data.getValue(e,t+1)},t.prototype.seriesLength=function(t){return this.data.getNumberOfRows()},t}(),JSONDataWrapper=function(){function t(t){if("string"==typeof t)this.object=JSON.parse(t);else{if("object"!=typeof t)throw Error("Please provide a JSON string or derived object.");this.object=t}}return t.prototype.numSeries=function(){return this.object.data.length},t.prototype.seriesNames=function(){for(var t=[],e=0;e<this.object.data.length;e++)t.push(this.object.data[e].series);return t},t.prototype.seriesMin=function(t){return Math.min.apply(this,this.object.data[t].values)},t.prototype.seriesMax=function(t){return Math.max.apply(this,this.object.data[t].values)},t.prototype.seriesValue=function(t,e){return this.object.data[t].values[e]},t.prototype.seriesLength=function(t){return this.object.data[t].values.length},t}(),HTMLTableDataWrapper=function(){function t(t){if(this.table=t,!this.table)throw Error("No table given.")}return t.prototype.numSeries=function(){return this.table.getElementsByTagName("tr")[0].children.length},t.prototype.seriesNames=function(){for(var t=this.table.getElementsByTagName("th"),e=[],a=0;a<t.length;a++)e.push(t[a].textContent);return e},t.prototype._seriesFloats=function(t){for(var e=this.table.getElementsByTagName("td"),a=[],r=0;r<e.length;r++)a.push(parseFloat(e[r].textContent));return a},t.prototype.seriesMin=function(t){return Math.min.apply(this,this._seriesFloats(t))},t.prototype.seriesMax=function(t){return Math.max.apply(this,this._seriesFloats(t))},t.prototype.seriesValue=function(t,e){return parseFloat(this.table.getElementsByTagName("tr")[e+1].children[t].textContent)},t.prototype.seriesLength=function(t){return this.table.getElementsByTagName("tr").length-1},t}(),PitchMapper=function(){function t(t,e){if(this.minimumDatum=t,this.maximumDatum=e,this.minimumDatum>this.maximumDatum)throw Error("minimum datum should be <= maximum datum")}return t.prototype.map=function(t){},t}(),FrequencyPitchMapper=function(){function t(t,e,a,r){if(this.minimumFrequency=a,this.maximumFrequency=r,PitchMapper.call(this,t,e),this.minimumFrequency>this.maximumFrequency)throw Error("minimum frequency should be <= maximum frequency");this.dataRange=this.maximumDatum-this.minimumDatum}return t.prototype=Object.create(PitchMapper.prototype),t.prototype.constructor=t,t.prototype.map=function(t){var e;return e=this.dataRange?(t-this.minimumDatum)/this.dataRange:.5,this.minimumFrequency+e*(this.maximumFrequency-this.minimumFrequency)},t}(),WebAudioSounder=function(){function t(t){this.context=t}return t.prototype.start=function(){this.oscillator=this.context.createOscillator(),this.oscillator.connect(this.context.destination),this.oscillator.start(0)},t.prototype.frequency=function(t){this.oscillator.frequency.value=t},t.prototype.stop=function(){this.oscillator.stop()},t}(),Player=function(){function t(t,e,a,r,i){this.data=e,this.pitchMapper=a,this.sounder=r,arguments.length<5?this.visualCallback=null:this.visualCallback=i,this.interval=Math.ceil(t/this.data.seriesLength(0)),this.seriesMaxIndex=this.data.seriesLength(0)-1,this._state="ready"}return t.prototype.playPause=function(){switch(this._state){case"ready":this._play();break;case"playing":this._pause();break;case"paused":this._playLoop();break;case"finished":this._play();break;default:throw Error("Player error: invalid state: "+String(this._state))}},t.prototype._play=function(){this.sounder.start(0),this.playIndex=0,this.skippedCalls=0,this._playLoop()},t.prototype._playLoop=function(){this._state="playing",this._playOne();var t=this;this.intervalID=setInterval(function(){t._playOneWrapper()},this.interval)},t.prototype._playOneWrapper=function(){if(isProbablySafari&&this.interval<10&&this.playIndex!==this.seriesMaxIndex&&this.playIndex%2==0)return this.playIndex++,void this.skippedCalls++;this._playOne()},t.prototype._playOne=function(){if(null!==this.visualCallback&&this.visualCallback(0,this.playIndex),this.sounder.frequency(this.pitchMapper.map(this.data.seriesValue(0,this.playIndex))),this.playIndex===this.seriesMaxIndex){clearInterval(this.intervalID);var t=this;setTimeout(function(){t.sounder.stop()},this.interval),this._state="finished"}this.playIndex+=1},t.prototype._pause=function(){clearInterval(this.intervalID),this._state="paused"},t.prototype.stepBackward=function(t){var e=t||50;this.playIndex-=e,this.playIndex<0&&(this.playIndex=0),"paused"===this._state&&this._playOne()},t.prototype.stepForward=function(t){var e=t||50;this.playIndex+=e,this.playIndex>this.seriesMaxIndex&&(this.playIndex=this.seriesMaxIndex),"paused"===this._state&&this._playOne()},t}(),AudioContextGetter=function(){function t(){}var e=null,a=function(){return void 0!==window.AudioContext?new window.AudioContext:void 0!==window.webkitAudioContext?(isProbablySafari=!0,new window.webkitAudioContext):null};return t.get=function(){return null!==e?e:e=a()},t}(),googleVisualCallbackMaker=function(t){return function(e,a){t.setSelection([{row:a,column:e+1}])}},htmlTableVisualCallbackMaker=function(t,e){return function(a,r){for(var i=t.getElementsByTagName("td"),n=0;n<i.length;n++)i[n].classList.remove(e);t.getElementsByTagName("td")[r].classList.add(e)}},KeyboardHandler=function(){function t(t,e){if(!t)throw Error("No container given");if(t.setAttribute("tabindex","0"),t.addEventListener("keydown",this.keypressHandler.bind(this)),!e)throw Error("No Player given");this.player=e}function e(t){if(t.key)return t.key;if(t.keyIdentifier)return t.keyIdentifier;throw new Error("Keyboard Events API unsupported")}return t.prototype.keypressHandler=function(t){t.preventDefault(),"Right"===e(t)?this.handleRight():"Left"===e(t)?this.handleLeft():"U+0020"===e(t)&&this.handleSpace()},t.prototype.handleLeft=function(){this.player.stepBackward()},t.prototype.handleRight=function(){this.player.stepForward()},t.prototype.handleSpace=function(){this.player.playPause()},t}(),_AudioChart=function(){function t(e,a){var r=t._assignWrapperCallback(e),i=new r.Wrapper(r.parameter),n=r.callback,s=new FrequencyPitchMapper(i.seriesMin(0),i.seriesMax(0),e.frequencyLow,e.frequencyHigh),o=new WebAudioSounder(a);this.player=new Player(e.duration,i,s,o,n),e.chartContainer&&new KeyboardHandler(e.chartContainer,this.player)}return t.prototype.playPause=function(){this.player.playPause()},t._assignWrapperCallback=function(t){var e={Wrapper:null,parameter:null,callback:null};switch(t.type){case"google":e.Wrapper=GoogleDataWrapper,e.parameter=t.data,t.hasOwnProperty("chart")&&(e.callback=googleVisualCallbackMaker(t.chart));break;case"json":e.Wrapper=JSONDataWrapper,e.parameter=t.data;break;case"htmlTable":e.Wrapper=HTMLTableDataWrapper,e.parameter=t.table,t.hasOwnProperty("highlightClass")&&(e.callback=htmlTableVisualCallbackMaker(t.table,t.highlightClass));break;default:throw Error("Invalid data type '"+t.type+"' given.")}return e},t}(),AudioChart=function(){return function(t,e){if(arguments.length<2&&null===(e=AudioContextGetter.get()))throw Error("Sorry, your browser doesn't support the Web Audio API.");return new _AudioChart(t,e)}}();exports.AudioChart=AudioChart;
//# sourceMappingURL=audiochart.min.js.map
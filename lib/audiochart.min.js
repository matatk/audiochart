"use strict";class AudioChart{constructor(e,t){const a="Sorry, your browser doesn't support the Web Audio API.";if(arguments.length<2){t=getAudioContext();if(t===null){throw Error(a)}}const s=AudioChart._assignWrapperCallback(e);const r=new s.Wrapper(s.parameter);const i=s.callback;const n=new FrequencyPitchMapper(r.seriesMin(0),r.seriesMax(0),e.frequencyLow,e.frequencyHigh);const l=new WebAudioSounder(t);this.player=new Player(e.duration,r,n,l,i);if(e.chartContainer){new KeyboardHandler(e.chartContainer,this.player)}}playPause(){this.player.playPause()}static _assignWrapperCallback(e){const t={Wrapper:null,parameter:null,callback:null};switch(e.type){case"google":t.Wrapper=GoogleDataWrapper;t.parameter=e.data;if(e.hasOwnProperty("chart")){t.callback=googleVisualCallbackMaker(e.chart)}break;case"json":t.Wrapper=JSONDataWrapper;t.parameter=e.data;break;case"htmlTable":t.Wrapper=HTMLTableDataWrapper;t.parameter=e.table;if(e.hasOwnProperty("highlightClass")){t.callback=htmlTableVisualCallbackMaker(e.table,e.highlightClass)}break;case"c3":t.Wrapper=C3DataWrapper;t.parameter=e.data;if(e.hasOwnProperty("chart")){t.callback=c3VisualCallbackMaker(e.chart)}break;default:throw Error("Invalid data type '"+e.type+"' given.")}return t}}"use strict";class GoogleDataWrapper{constructor(e){this.data=e}numSeries(){return this.data.getNumberOfColumns()-1}seriesNames(){const e=[];for(let t=0;t<this.data.getNumberOfColumns()-1;t++){e.push(this.data.getColumnLabel(t))}return e}seriesMin(e){return this.data.getColumnRange(e+1).min}seriesMax(e){return this.data.getColumnRange(e+1).max}seriesValue(e,t){return this.data.getValue(t,e+1)}seriesLength(e){return this.data.getNumberOfRows()}}class JSONDataWrapper{constructor(e){if(typeof e==="string"){this.object=JSON.parse(e)}else if(typeof e==="object"){this.object=e}else{throw Error("Please provide a JSON string or derived object.")}}numSeries(){return this.object.data.length}seriesNames(){const e=[];for(let t=0;t<this.object.data.length;t++){e.push(this.object.data[t].series)}return e}seriesMin(e){return Math.min.apply(this,this.object.data[e].values)}seriesMax(e){return Math.max.apply(this,this.object.data[e].values)}seriesValue(e,t){return this.object.data[e].values[t]}seriesLength(e){return this.object.data[e].values.length}}class C3DataWrapper{constructor(e){if(typeof e==="object"){this.object=e}else{throw Error("Please provide a C3-format data object.")}}numSeries(){return this.object.columns.length}seriesNames(){const e=[];for(let t=0;t<this.object.columns.length;t++){e.push(this.object.columns[t][0])}return e}seriesMin(e){return Math.min.apply(this,this.object.columns[e].slice(1))}seriesMax(e){return Math.max.apply(this,this.object.columns[e].slice(1))}seriesValue(e,t){return this.object.columns[e][t+1]}seriesLength(e){return this.object.columns[e].length-1}}class HTMLTableDataWrapper{constructor(e){this.table=e;if(!this.table){throw Error("No table given.")}}numSeries(){return this.table.getElementsByTagName("tr")[0].children.length}seriesNames(){const e=this.table.getElementsByTagName("th");const t=[];for(let a=0;a<e.length;a++){t.push(e[a].textContent)}return t}_seriesFloats(e){const t=this.table.getElementsByTagName("td");const a=[];for(let e=0;e<t.length;e++){a.push(parseFloat(t[e].textContent))}return a}seriesMin(e){return Math.min.apply(this,this._seriesFloats(e))}seriesMax(e){return Math.max.apply(this,this._seriesFloats(e))}seriesValue(e,t){return parseFloat(this.table.getElementsByTagName("tr")[t+1].children[e].textContent)}seriesLength(e){return this.table.getElementsByTagName("tr").length-1}}"use strict";class KeyboardHandler{constructor(e,t){if(!e){throw Error("No container given")}if(!t){throw Error("No Player given")}e.setAttribute("tabindex","0");e.addEventListener("keydown",this.keypressHandler.bind(this));this.player=t}keypressHandler(e){e.preventDefault();if(e.key==="ArrowRight"){this.handleRight()}else if(e.key==="ArrowLeft"){this.handleLeft()}else if(e.key===" "){this.handleSpace()}}handleLeft(){this.player.stepBackward()}handleRight(){this.player.stepForward()}handleSpace(){this.player.playPause()}}"use strict";class PitchMapper{constructor(e,t){this.minimumDatum=e;this.maximumDatum=t;if(this.minimumDatum>this.maximumDatum){throw Error("minimum datum should be <= maximum datum")}}map(e){throw new Error("Base map() must be overriden.")}}class FrequencyPitchMapper extends PitchMapper{constructor(e,t,a,s){super(e,t);this.minimumFrequency=a;this.maximumFrequency=s;if(this.minimumFrequency>this.maximumFrequency){throw Error("minimum frequency must be <= maximum frequency")}this.dataRange=this.maximumDatum-this.minimumDatum}map(e){let t;if(this.dataRange){t=(e-this.minimumDatum)/this.dataRange}else{t=.5}return this.minimumFrequency+t*(this.maximumFrequency-this.minimumFrequency)}}"use strict";class Player{constructor(e,t,a,s,r){this.data=t;this.pitchMapper=a;this.sounder=s;if(arguments.length<5){this.visualCallback=null}else{this.visualCallback=r}const i=this.data.seriesLength(0);const n=Player.samplingInfo(e,i);this.interval=n.interval;this.sampleOneIn=n.in;this.seriesMaxIndex=i-1;this._state="ready"}static samplingInfo(e,t){const a=10;let s;let r;let i;const n=Math.ceil(e/t);console.log(`sampleInfo: duration: ${e}; series length: ${t}; ideal interval: ${n}`);if(n<a){s=a;i=Math.floor(e/a);const n=t/i;r=Math.round(t/i);console.log(`sampleInfo: Need to sample 1 in ${r} (${n})`)}else{i=Math.floor(e/a);s=n;r=1}console.log(`sampleInfo: it will take ${t/r*s}`);return{sample:1,in:r,interval:s}}playPause(){switch(this._state){case"ready":this._play();break;case"playing":this._pause();break;case"paused":this._playLoop();break;case"finished":this._play();break;default:throw Error("Player error: invalid state: "+String(this._state))}}_play(){this.playTimes=[];this.playCount=0;this.startTime=performance.now();this.sounder.start(0);this.playIndex=0;this._playLoop()}_playLoop(){this._state="playing";this._playOne();this.intervalID=setInterval(()=>this._playOne(),this.interval)}_playOne(){const e=performance.now();if(this.playIndex<=this.seriesMaxIndex){if(this.visualCallback!==null){this.visualCallback(0,this.playIndex)}this.sounder.frequency(this.pitchMapper.map(this.data.seriesValue(0,this.playIndex)))}else{clearInterval(this.intervalID);this.sounder.stop();this._state="finished";console.log(`Player: Playing ${this.playCount} of ${this.playIndex} took ${Math.round(performance.now()-this.startTime)} ms`);const e=this.playTimes.reduce((e,t)=>e+t);const t=e/this.playTimes.length;console.log(`Player: Average play func time: ${t.toFixed(2)} ms`)}this.playIndex+=this.sampleOneIn>0?this.sampleOneIn:1;this.playCount+=1;this.playTimes.push(performance.now()-e)}_pause(){clearInterval(this.intervalID);this._state="paused"}stepBackward(e){const t=e||50;this.playIndex-=t;if(this.playIndex<0){this.playIndex=0}if(this._state==="paused"){this._playOne()}}stepForward(e){const t=e||50;this.playIndex+=t;if(this.playIndex>this.seriesMaxIndex){this.playIndex=this.seriesMaxIndex}if(this._state==="paused"){this._playOne()}}}"use strict";class WebAudioSounder{constructor(e){this.context=e}start(){this.oscillator=this.context.createOscillator();this.oscillator.connect(this.context.destination);this.oscillator.start(0)}frequency(e){this.oscillator.frequency.value=e}stop(){this.oscillator.stop()}}"use strict";var getAudioContext=function(){let e=null;if(window.AudioContext!==undefined){e=new window.AudioContext}else if(window.webkitAudioContext!==undefined){e=new window.webkitAudioContext}function t(){return e}return t}();"use strict";var googleVisualCallbackMaker=function(e){return function(t,a){e.setSelection([{row:a,column:t+1}])}};var htmlTableVisualCallbackMaker=function(e,t){return function(a,s){const r=e.getElementsByTagName("td");let i;for(let e=0;e<r.length;e++){i=r[e];i.classList.remove(t)}i=e.getElementsByTagName("td")[s];i.classList.add(t)}};var c3VisualCallbackMaker=function(e){return function(t,a){e.select(null,[a],true)}};
"use strict";!function(t){class e{constructor(t){this.data=t}numSeries(){let t=0;for(let e=1;e<this.data.getNumberOfColumns();e++){const s=this.data.getColumnRole(e);""!==s&&"data"!==s||(t+=1)}return t}seriesNames(){const t=[];for(let e=0;e<this.data.getNumberOfColumns()-1;e++)t.push(this.data.getColumnLabel(e));return t}seriesMin(t){return this.data.getColumnRange(t+1).min}seriesMax(t){return this.data.getColumnRange(t+1).max}seriesValue(t,e){return this.data.getValue(e,t+1)}seriesLength(t){return this.data.getNumberOfRows()}}class s{constructor(t){if("string"==typeof t)this.object=JSON.parse(t);else{if("object"!=typeof t)throw Error("Please provide a JSON string or derived object.");this.object=t}}numSeries(){return this.object.data.length}seriesNames(){const t=[];for(let e=0;e<this.object.data.length;e++)t.push(this.object.data[e].series);return t}seriesMin(t){return Math.min.apply(this,this.object.data[t].values)}seriesMax(t){return Math.max.apply(this,this.object.data[t].values)}seriesValue(t,e){return this.object.data[t].values[e]}seriesLength(t){return this.object.data[t].values.length}}class a{constructor(t){if("object"!=typeof t)throw Error("Please provide a C3-format data object.");this.object=t}numSeries(){let t=this.object.columns.length;return this.object.hasOwnProperty("x")&&(t-=1),t}seriesNames(){const t=[];for(let e=0;e<this.object.columns.length;e++)t.push(this.object.columns[e][0]);return t}seriesMin(t){return Math.min.apply(this,this.object.columns[t].slice(1))}seriesMax(t){return Math.max.apply(this,this.object.columns[t].slice(1))}seriesValue(t,e){return this.object.columns[t][e+1]}seriesLength(t){return this.object.columns[t].length-1}}class r{constructor(t){if(this.table=t,!this.table)throw Error("No table given.")}numSeries(){return this.table.getElementsByTagName("tr")[0].children.length}seriesNames(){return Array.from(this.table.getElementsByTagName("th"),t=>t.textContent)}_seriesFloats(t){return Array.from(this.table.querySelectorAll(`td:nth-child(${t+1})`),t=>parseFloat(t.textContent))}seriesMin(t){return Math.min.apply(this,this._seriesFloats(t))}seriesMax(t){return Math.max.apply(this,this._seriesFloats(t))}seriesValue(t,e){return parseFloat(this.table.getElementsByTagName("tr")[e+1].children[t].textContent)}seriesLength(t){return this.table.getElementsByTagName("tr").length-1}}class i{constructor(t){this._minimumDatum=[],this._maximumDatum=[],this._minimumFrequency=[],this._maximumFrequency=[],this._dataRange=[],this._frequencyRange=[],t.forEach((t,e)=>{if(t.maximumDatum<t.minimumDatum)throw Error("minimum datum should be <= maximum datum");if(t.maximumFrequency<t.minimumFrequency)throw Error("minimum frequency should be <= maximum frequency");this._minimumDatum[e]=t.minimumDatum,this._maximumDatum[e]=t.maximumDatum,this._minimumFrequency[e]=t.minimumFrequency,this._maximumFrequency[e]=t.maximumFrequency,this._dataRange[e]=this._maximumDatum[e]-this._minimumDatum[e],this._frequencyRange[e]=this._maximumFrequency[e]-this._minimumFrequency[e]})}map(t){throw Error("Base map() must be overriden.")}}class n extends i{constructor(t){super(t)}map(t,e){let s;return s=this._dataRange[t]?(e-this._minimumDatum[t])/this._dataRange[t]:.5,this._minimumFrequency[t]+s*this._frequencyRange[t]}}class o{constructor(t,e){if(void 0===t)throw Error("No audio context given");if(this._context=t,void 0===e)throw Error("No number of data series given");if(e>2)throw Error("Large number of data series given");this._numberOfSeries=e}start(){this._oscillators=[];for(let t=0;t<this._numberOfSeries;t++)this._oscillators[t]=this._context.createOscillator(),1===t&&(this._oscillators[t].type="square"),this._oscillators[t].connect(this._context.destination),this._oscillators[t].start(0)}frequency(t,e){this._oscillators[t].frequency.value=e}stop(){this._oscillators.forEach(t=>t.stop())}}class l{constructor(t,e,s,a,r){this.data=e,this.pitchMapper=s,this.sounder=a,arguments.length<5?this.visualCallback=null:this.visualCallback=r;const i=this.data.seriesLength(0);this._numberOfSeries=this.data.numSeries();const n=l._samplingInfo(t,i);this.interval=n.interval,this.sampleOneIn=n.in,this.seriesMaxIndex=i-1,this._state="ready"}playPause(){switch(this._state){case"ready":this._play();break;case"playing":this._pause();break;case"paused":this._playLoop();break;case"finished":this._play();break;default:throw Error("Player error: invalid state: "+String(this._state))}}stepBackward(t){const e=t||50;this.playIndex-=e,this.playIndex<0&&(this.playIndex=0),"paused"===this._state&&this._playOne()}stepForward(t){const e=t||50;this.playIndex+=e,this.playIndex>this.seriesMaxIndex&&(this.playIndex=this.seriesMaxIndex),"paused"===this._state&&this._playOne()}_play(){this.playTimes=[],this.playCount=0,this.startTime=performance.now(),this.sounder.start(0),this.playIndex=0,this._playLoop()}_playLoop(){this._state="playing",this._playOne(),this.intervalID=setInterval(()=>this._playOne(),this.interval)}_playOne(){const t=performance.now();if(this.playIndex<=this.seriesMaxIndex){null!==this.visualCallback&&this.visualCallback(this.playIndex);for(let t=0;t<this._numberOfSeries;t++)this.sounder.frequency(t,this.pitchMapper.map(t,this.data.seriesValue(t,this.playIndex)))}else{clearInterval(this.intervalID),this.sounder.stop(),this._state="finished";this.playTimes.reduce((t,e)=>t+e),this.playTimes.length}this.playIndex+=this.sampleOneIn>0?this.sampleOneIn:1,this.playCount+=1,this.playTimes.push(performance.now()-t)}_pause(){clearInterval(this.intervalID),this._state="paused"}static _samplingInfo(t,e){let s,a,r;const i=Math.ceil(t/e);if(i<10){s=10;r=Math.floor(t/10);a=Math.round(e/r)}else r=Math.floor(t/10),s=i,a=1;return{sample:1,in:a,interval:s}}}var h=function(){let t=null;return void 0!==window.AudioContext?t=new window.AudioContext:void 0!==window.webkitAudioContext&&(t=new window.webkitAudioContext),function(){return t}}(),u=function(t){return function(e){t.setSelection([{row:e}])}},c=function(t,e){return function(s){const a=t.getElementsByTagName("tr");for(const t of a)t.classList.remove(e);a[s+1].classList.add(e)}},m=function(t){return function(e){t.select(null,[e],!0)}};class p{constructor(t,e){if(!t)throw Error("No container given");if(!e)throw Error("No Player given");t.setAttribute("tabindex","0"),t.addEventListener("keydown",this.keypressHandler.bind(this)),this.player=e}keypressHandler(t){t.preventDefault(),"ArrowRight"===t.key?this.handleRight():"ArrowLeft"===t.key?this.handleLeft():" "===t.key&&this.handleSpace()}handleLeft(){this.player.stepBackward()}handleRight(){this.player.stepForward()}handleSpace(){this.player.playPause()}}class d{constructor(t){const e=h();if(null===e)throw Error("Sorry, your browser doesn't support the Web Audio API.");this._setUp(e,t)}playPause(){this.player.playPause()}get options(){return this._options}updateOptions(t){if(void 0===t||0===Object.keys(t).length)throw Error("No new options given");const e=Object.assign({},this._options,t);this._setUp(h(),e)}_setUp(t,e){d._checkOptions(e),this._wireUpStuff(t,e),this._options=Object.freeze(e)}static _checkOptions(t){if(!t.hasOwnProperty("duration"))throw Error("No duration given");if(!t.hasOwnProperty("frequencyLow"))throw Error("No minimum frequency given");if(!t.hasOwnProperty("frequencyHigh"))throw Error("No maximum frequency given");switch(t.type){case"google":case"c3":case"json":if(!t.hasOwnProperty("data"))throw Error("Options must include a 'data' key");break;case"htmlTable":if(!t.hasOwnProperty("table"))throw Error("Options must include a 'table' key");break;default:throw Error(`Invalid data type '${t.type}' given.`)}}_wireUpStuff(t,e){const s=d._assignWrapperCallback(e),a=new s.WrapperClass(s.dataSource),r=s.visualCallback,i=a.numSeries(),h=[];for(let t=0;t<i;t++)h.push({minimumDatum:a.seriesMin(t),maximumDatum:a.seriesMax(t),minimumFrequency:e.frequencyLow,maximumFrequency:e.frequencyHigh});const u=new n(h),c=new o(t,i);this.player=new l(e.duration,a,u,c,r),e.chartContainer&&new p(e.chartContainer,this.player)}static _assignWrapperCallback(t){const i={WrapperClass:null,dataSource:null,visualCallback:null},n={google:e,json:s,htmlTable:r,c3:a},o={google:u,c3:m};switch(t.type){case"google":case"json":case"c3":i.WrapperClass=n[t.type],i.dataSource=t.data,t.hasOwnProperty("chart")&&(i.visualCallback=o[t.type](t.chart));break;case"htmlTable":i.WrapperClass=r,i.dataSource=t.table,t.hasOwnProperty("highlightClass")&&(i.visualCallback=c(t.table,t.highlightClass))}return i}}t.AudioChart=d}(this);
//# sourceMappingURL=audiochart.min.js.map